![Lines of code](https://img.shields.io/tokei/lines/github/mirogaudi/memo-service)
![GitHub top language](https://img.shields.io/github/languages/top/mirogaudi/memo-service)
![GitHub gradle workflow status](https://img.shields.io/github/actions/workflow/status/mirogaudi/memo-service/gradle.yml?branch=main)
![JaCoCo coverage](https://img.shields.io/endpoint?url=https://raw.githubusercontent.com/mirogaudi/memo-service/main/.github/badges/jacoco.json)
![JaCoCo branches](https://img.shields.io/endpoint?url=https://raw.githubusercontent.com/mirogaudi/memo-service/main/.github/badges/branches.json)
![GitHub license](https://img.shields.io/github/license/mirogaudi/memo-service)

# MEMO Service with REST API

## Description

Application is a demo of a simple memos (notes) service

### Used technologies

- Kotlin (jvmTarget 17)
- Gradle (wrapper)
- Spring Boot
- Spring Web MVC
- Spring Data JPA
- Flyway DB migration tool
- H2 in-memory DB
- Docker
- OpenAPI 3 & Swagger UI (springdoc-openapi)
- Swagger Codegen
- JUnit Jupiter
- MockK
- Springmockk
- Ktlint
- Detekt
- JaCoCo
- Kover (with IntelliJ coverage engine)

#### Misc

- Repository is licensed under [Apache License 2.0](https://www.apache.org/licenses/LICENSE-2.0.html)
- Repository uses GitHub Actions ([Java_CI_with_Gradle](.github/workflows/gradle.yml))
- Repository uses Dependabot version updates ([dependabot.yml](.github/dependabot.yml))
- Readme badges are rendered using [shields.io](https://github.com/badges/shields)
- JaCoCo badges are generated by [jacoco-badge-generator](https://github.com/cicirello/jacoco-badge-generator)
- ER diagram is generated by [mermaid.live](https://mermaid.live)
- ASCII Art for [SpringBoot banner](src/main/resources/banner.txt) was generated
  with [TAAG](http://patorjk.com/software/taag) (font Calvin S)

### Functionality

- Application implements CRUD operations for memos and labels
- Memo and label services are `@Transactional` to avoid race condition

### Database

Application DB stores labeled text memos:

[![](https://mermaid.ink/img/pako:eNqVksFqwzAMhl9F6Ny-QM7bLr0UdjUUNVYTQ2wHWRkrad59idsNl6aD-mCw_u-XkKwR62gZK2R5c9QIeRPg73R05A7GMgRwdI0LCs7CfnevfJHULQkE8lzGS2oyoXx69vH1Asrfuq704qI4Pd-r6jwnJd9DLUzK9mDn-xljB876Cy0c_ptUBuZuPnarcrY-6muDulxgu4U4FjUrMNhSumZJBh-_74mJUnJNYAsas5K9uEHP4snZeSVyNwa1Zc8GF4_lEw2dLuQ0o0O_jOndOo2C1Ym6xBukQePnOdRYqQz8C92W60ZNP8bts1Q)](https://mermaid.live/edit#pako:eNqVksFqwzAMhl9F6Ny-QM7bLr0UdjUUNVYTQ2wHWRkrad59idsNl6aD-mCw_u-XkKwR62gZK2R5c9QIeRPg73R05A7GMgRwdI0LCs7CfnevfJHULQkE8lzGS2oyoXx69vH1Asrfuq704qI4Pd-r6jwnJd9DLUzK9mDn-xljB876Cy0c_ptUBuZuPnarcrY-6muDulxgu4U4FjUrMNhSumZJBh-_74mJUnJNYAsas5K9uEHP4snZeSVyNwa1Zc8GF4_lEw2dLuQ0o0O_jOndOo2C1Ym6xBukQePnOdRYqQz8C92W60ZNP8bts1Q)

DB migration is done with Flyway using scripts:

- [V1__create_schema.sql](src/main/resources/db/migration/V1__create_schema.sql)
    - initial script `build/resources/main/db/create_schema.sql` is generated with Spring Data JPA when starting
      application with `dev` profile (for details see [application-dev.yml](src/main/resources/application-dev.yml))
- [V2__insert_data.sql](src/main/resources/db/migration/V2__insert_data.sql)

Application uses H2 in-memory DB

### Configuration

See configuration in [application.yml](src/main/resources/application.yml)

## Getting started

### Gradle build

```shell
# Build with Gradle wrapper
$ ./gradlew build

# Build with Gradle wrapper continuing on task failures
$ ./gradlew --continue build

# Build with Gradle wrapper deleting the build directory 
$ ./gradlew clean build
```

### Docker build

```shell
# Build and tag docker image with Docker (requires artifacts to be already built)
$ docker build -t mirogaudi/memo-service:1.0.0 .
$ docker tag mirogaudi/memo-service:1.0.0 mirogaudi/memo-service:latest

# Build docker image with Gradle wrapper (via Docker plugin)
$ ./gradlew dockerBuildImage
```

### Run

```shell
# Run with Java
$ java -jar build/libs/memo-service-*.jar

# Run with Gradle wrapper (via Spring Boot plugin)
$ ./gradlew bootRun

# Run with Docker
$ docker run -it -d --rm --name memo-service -p 8080:8080 mirogaudi/memo-service:latest
```

- Or just run `MemoServiceApplication` in an IDE

### View and try API

- OpenAPI docs: [http://localhost:8080/ms/v3/api-docs](http://localhost:8080/ms/v3/api-docs)
- Swagger UI: [http://localhost:8080/ms/swagger-ui/index.html](http://localhost:8080/ms/swagger-ui/index.html)

#### Generate API docs in a file

```shell
# Build generating OpenAPI docs using springdoc-openapi Gradle plugin
$ ./gradlew generateOpenApiDocs
```

Generated API docs file `build/docs/memo-service-openapi.json` can be viewed
with IntelliJ or [https://editor.swagger.io/](https://editor.swagger.io/)

### View DB

- H2 console [http://localhost:8080/ms/h2-console](http://localhost:8080/ms/h2-console)
    - url: `jdbc:h2:mem:ms`
    - username: `sa`
    - password: `<empty>`

## Code quality

### Code style

Code style is set using [.editorconfig](.editorconfig) file (refers to
Ktlint [.editorconfig](https://github.com/pinterest/ktlint/blob/master/.editorconfig) file)

### Linter

```shell
# Lint with Ktlint using Kotlinter Gradle plugin (check is also dependent on lintKotlin)
$ ./gradlew lintKotlin
```

### Static code analysis

```shell
# Check code using Detekt Gradle plugin (check is also dependent on detekt)
$ ./gradlew detekt
```

### Code coverage

```shell
# Run tests generating JaCoCo code coverage report using JaCoCo Gradle plugin
$ ./gradlew jacocoTestReport

# Run tests generating Kover code coverage HTML report using Kover Gradle plugin
$ ./gradlew koverHtmlReport
```

### Dependencies vulnerabilities

#### OWASP

```shell
# Generate OWASP dependency vulnerability report using OWASP Gradle plugin
$ ./gradlew dependencyCheckAnalyze
```

## Maintenance

### Update dependencies

```shell
# Check for dependency updates using Versions Gradle plugin
$ ./gradlew dependencyUpdates

# Update Gradle wrapper
$ ./gradlew wrapper --gradle-version <version>
```

### Check Gradle task dependencies

```shell
# Show Gradle 'build' task dependencies order using Gradle wrapper dry run
$ ./gradlew build --dry-run

# Show Gradle 'build' task dependencies order using Gradle wrapper (via taskinfo plugin)
$ ./gradlew tiOrder build

# Show Gradle 'build' task dependencies tree using Gradle wrapper (via taskinfo plugin)
$ ./gradlew tiTree build
```

## TODO:

- implement for Memo and Label:
    - services
    - controllers
    - tests
- add http client calls
